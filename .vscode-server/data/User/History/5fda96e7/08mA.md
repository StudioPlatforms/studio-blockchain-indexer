# Uniswap V3 Contract Verification Guide

This guide explains how to verify Uniswap V3 contracts on the Studio blockchain using the enhanced verification system with import support.

## Overview

The verification system has been enhanced to support contract imports, which is essential for verifying complex contracts like Uniswap V3 that rely on multiple imported files. The key improvements include:

1. **Import Handler**: A new component that resolves import paths and provides file content to the Solidity compiler.
2. **Import Mappings**: The ability to provide mappings from import paths to file content in verification requests.
3. **Enhanced API**: The verification API now accepts import mappings as part of the verification request.

## Verification Process

### Option 1: Using the Automated Script

The easiest way to verify the Uniswap V3 contracts is to use the provided automated script:

```bash
./run-verification-with-imports.sh
```

This script will:
1. Install the required dependencies
2. Apply the verification fix to the indexer
3. Run the verification script with import support

### Option 2: Manual Verification

If you prefer to verify contracts manually, you can use the following steps:

1. **Apply the Verification Fix**:
   ```bash
   ./apply-verification-fix.sh
   ```

2. **Create Import Mappings**:
   Create a JSON object that maps import paths to file content. For example:
   ```json
   {
     "@uniswap/v3-core/contracts/interfaces/IUniswapV3Factory.sol": "// SPDX-License-Identifier: GPL-2.0-or-later\npragma solidity >=0.5.0;\n..."
   }
   ```

3. **Submit Verification Request**:
   Send a POST request to the verification API with the source code, compiler settings, and import mappings:
   ```bash
   curl -X POST https://mainnetindexer.studio-blockchain.com/contracts/verify \
     -H "Content-Type: application/json" \
     -d '{
       "address": "0x6f1aF63eb91723a883c632E38D34f2cB6090b805",
       "sourceCode": "// SPDX-License-Identifier: BUSL-1.1\npragma solidity =0.7.6;\n...",
       "compilerVersion": "0.7.6",
       "contractName": "UniswapV3Factory",
       "optimizationUsed": true,
       "runs": 800,
       "evmVersion": "istanbul",
       "constructorArguments": "",
       "importMappings": {
         "@uniswap/v3-core/contracts/interfaces/IUniswapV3Factory.sol": "// SPDX-License-Identifier: GPL-2.0-or-later\npragma solidity >=0.5.0;\n..."
       }
     }'
   ```

## Contract Details

The Uniswap V3 contracts deployed on the Studio blockchain are:

1. **UniswapV3Factory** (0x6f1aF63eb91723a883c632E38D34f2cB6090b805)
2. **NFTDescriptor** (0x6E186Abde1aedCCa4EAa08b4960b2A2CC422fEd6)
3. **NonfungibleTokenPositionDescriptor** (0x68550Fc74cf81066ef7b8D991Ce76C8cf685F346)
4. **SwapRouter** (0x5D16d5b06bB052A91D74099A70D4048143a56406)
5. **NonfungiblePositionManager** (0x402306D1864657168B7614E459C7f3d5be0677eA)
6. **WETH9** (0x5CCa138772f7ec71aDf95029291F87D26D0c0dB0)

## Technical Details

### Import Handler

The import handler is a new component that resolves import paths and provides file content to the Solidity compiler. It supports:

- Direct mappings from import paths to file content
- Base path resolution for relative imports
- Error handling for missing imports

### API Changes

The verification API now accepts an additional parameter:

- `importMappings`: A JSON object that maps import paths to file content

### Implementation Details

The implementation consists of:

1. **import-handler.ts**: A new file that implements the import handler
2. **index.ts**: Updated verification service that uses the import handler
3. **contracts-verification.ts**: A new API service that handles verification requests with import support

## Troubleshooting

If you encounter issues during verification:

1. **Check Import Paths**: Ensure that all import paths in your contract match the keys in your import mappings.
2. **Verify File Content**: Make sure the file content in your import mappings is correct and complete.
3. **Check Compiler Version**: Ensure you're using the correct compiler version for your contract.
4. **Check EVM Version**: Try different EVM versions if verification fails.
5. **Check Logs**: Look at the indexer logs for more detailed error information.

## Conclusion

With the enhanced verification system, you can now verify complex contracts like Uniswap V3 that rely on multiple imported files. This makes it easier to verify and interact with these contracts on the Studio blockchain.
